services:
    controller.authentication:
        public: true
        class: 'App\Membership\Infrastructure\Security\Authentication\Controller\AuthenticationController'
        properties:
            authenticator: '@app.authenticator'

    controller.healthcheck:
        public: true
        class: 'App\Infrastructure\Healthcheck\Controller\HealthcheckController'
        arguments:
            - '%allowed.origin%'
            - '%kernel.environment%'

    controller.list:
        public: true
        class: 'App\PublicationList\Controller\ListController'
        arguments:
            - '%allowed.origin%'
            - '%kernel.environment%'
        calls:
            - [ 'setPublicationListDispatcher', ['@App\Infrastructure\Amqp\MessageBus\PublicationListDispatcher']]
        properties:
            serviceAccountConfig:           "%kernel.project_dir%/config/%env(resolve:FIREBASE_SERVICE_ACCOUNT_CONFIG)%"
            databaseUri:                    "%env(resolve:FIREBASE_DATABASE_URI)%"
            authenticationTokenRepository:  '@repository.authentication_token'
            aggregateRepository:            '@App\Infrastructure\Api\Repository\PublicationListRepository'
            highlightRepository:            '@repository.highlight'
            logger:                         '@logger'
            memberRepository:               '@user_manager'
            router:                         '@router'
            redisCache:                     '@app.cache.redis'
            timelyStatusRepository:         '@repository.timely_status'
            tokenRepository:                '@repository.access_token'

    controller.logged_in_member:
        public: true
        class: 'App\Membership\Infrastructure\Controller\LoggedInMemberController'
        arguments:
            - '%allowed.origin%'
            - '%kernel.environment%'
        properties:
            logger:                        '@logger'
            authenticationTokenRepository: '@repository.authentication_token'

    controller.keyword:
        public: true
        class: 'App\PublicationList\Controller\KeywordController'
        arguments:
            - '%allowed.origin%'
            - '%kernel.environment%'
        properties:
            keywordRepository: '@repository.keyword'
            redisCache:        '@app.cache.redis'

    controller.member:
        public: true
        class: 'App\Infrastructure\Membership\Controller\MemberController'
        arguments:
            - '%allowed.origin%'
            - '%kernel.environment%'
        calls:
            - [ 'setLogger',            [ '@logger' ] ]
            - [ 'setHttpAuthenticator', [ '@App\Infrastructure\Security\Authentication\HttpAuthenticator' ] ]
        properties:
            memberProfileAccessor:  '@App\Infrastructure\Twitter\Api\Accessor\MemberProfileAccessor'

    controller.publication:
        public: true
        class: 'App\Infrastructure\Publication\Controller\PublicationController'
        arguments:
            - '%allowed.origin%'
            - '%kernel.environment%'
        calls:
            - [ 'setCache',                 [ '@app.cache.redis' ]]
            - [ 'setLogger',            [ '@logger' ] ]
            - [ 'setPublicationRepository', [ '@App\Twitter\Repository\PublicationRepository' ]]
            - [ 'setStatusAccessor',    [ '@App\Infrastructure\Twitter\Api\Accessor\StatusAccessor' ]]
            - [ 'setStatusRepository',  [ '@App\Infrastructure\Api\Repository\StatusRepository' ]]

    controller.publication_list:
        public: true
        class: 'App\PublicationList\Controller\PublicationListController'
        arguments:
            - '%allowed.origin%'
            - '%kernel.environment%'
        calls:
            - [ 'setHttpAuthenticator', [ '@App\Infrastructure\Security\Authentication\HttpAuthenticator' ] ]
            - [ 'setPublicationListRepository', [ '@App\Infrastructure\Api\Repository\PublicationListRepository' ]]
        properties:
            redisCache:          '@app.cache.redis'

    controller.subscription:
        public: true
        class: 'App\Infrastructure\Subscription\Controller\SubscriptionController'
        arguments:
            - '%allowed.origin%'
            - '%kernel.environment%'
        calls:
            - [ 'setHttpAuthenticator',            [ '@App\Infrastructure\Security\Authentication\HttpAuthenticator' ] ]
            - [ 'setLogger',                       [ '@monolog.logger.membership' ] ]
            - [ 'setMemberSubscriptionRepository', [ '@repository.member_subscription' ] ]
            - [ 'setMemberRepository',             [ '@App\Infrastructure\Repository\Membership\MemberRepository' ] ]
            - [ 'setPublicationListDispatcher',    [ '@App\Infrastructure\Amqp\MessageBus\PublicationListDispatcher' ] ]
            - [ 'setTokenRepository',              [ '@repository.access_token' ] ]
        properties:
            redisCache:                     '@app.cache.redis'
